import Header from './components/layout/header.tsx';
import ProjectCard from './components/molecules/projectCard.tsx';
import React, { useState, useRef, useEffect } from 'react';
import ProjectSlider from './components/molecules/projectSlider.jsx';
import Loader from "./components/layout/loader.tsx";
import Footer from './components/layout/footer.tsx';
import eventBus from './scripts/eventBus.js';
import { animate, spring } from 'motion';

export const App = () => {
    const [currentProject, setCurrentProject] = useState();
    const [styckyScrolled, setStickyScrolled] = useState(0);

    const stickySection = useRef();
    const stickyTrack = useRef();

    const scrubAnimation = () => {
        // Check percentage section scrolled 

        document.addEventListener('scroll', (e) => {


            let stickySectionRect = stickySection.current.getBoundingClientRect();
            let stickySectionRectBottom = (stickySectionRect.top - window.scrollY);

            setStickyScrolled((-stickySectionRect.top / (stickySectionRect.height - window.innerHeight)) * 100);
        })

    }

    const trackWidth = () => {
        return stickyTrack.current ? stickyTrack.current.getBoundingClientRect().width - (window.innerWidth) : 0;
    }

    useEffect(() => {
        scrubAnimation();
        window?.lenis?.scrollTo(0, 0);

        eventBus.on('loadingFinished', ()=>{
            animate("#content > section:nth-child(1) > *", {transform: "translateY(8px)"}, {duration:0})
            animate('#content > section:nth-child(1) > *', {opacity: 1, transform: 'translateY(0)'}, {delay: (index)=>{
                return index * 0.1;
            }, easing: "ease-in-out"});
        });
    }, [])

    useEffect(() => {
        if (!currentProject || currentProject < 1) {
            window?.lenis.start()
        } else {
            window?.lenis.stop()
        }
    }, [currentProject])
    return (
        <> <Loader />
            <Header />     
            <div id="content" className='opacity-0'>


                <section className='flex flex-col flex-8 justify-center items-center py-64'>
                    <svg className='opacity-0' width="106" height="12" viewBox="0 0 106 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4.644 11L0.948 11.012C1.344 10.952 1.584 10.676 1.68 10.196C1.776 9.716 1.824 8.588 1.824 6.812C1.824 5.036 1.776 3.908 1.68 3.428C1.584 2.948 1.344 2.672 0.948 2.612H4.308C5.76 2.612 6.9 2.996 7.716 3.776C8.532 4.556 8.94 5.564 8.94 6.8C8.94 8 8.568 8.996 7.824 9.8C7.08 10.604 6.024 11 4.644 11ZM4.632 10.844L4.62 10.856C5.484 10.856 6.204 10.508 6.78 9.812C7.356 9.116 7.644 8.12 7.644 6.812C7.644 6.14 7.5 5.504 7.212 4.904C6.924 4.304 6.492 3.8 5.916 3.404C5.34 3.008 4.68 2.804 3.948 2.804C3.648 2.804 3.372 2.84 3.12 2.924C2.952 3.572 2.868 4.88 2.868 6.836C2.868 8.72 2.916 9.92 3 10.436C3.144 10.568 3.384 10.664 3.708 10.736C4.032 10.808 4.344 10.844 4.632 10.844ZM14.1379 2.432L14.1139 2.456C14.9899 2.456 15.7579 2.672 16.4179 3.104C17.0779 3.536 17.5699 4.076 17.8819 4.724C18.1939 5.372 18.3499 6.068 18.3499 6.824C18.3499 7.58 18.1939 8.276 17.8819 8.924C17.5699 9.572 17.0899 10.112 16.4299 10.544C15.7699 10.976 15.0019 11.192 14.1259 11.192C13.2499 11.192 12.4819 10.976 11.8219 10.544C11.1619 10.112 10.6819 9.572 10.3699 8.924C10.0579 8.276 9.90188 7.568 9.90188 6.812C9.90188 6.056 10.0579 5.348 10.3699 4.7C10.6819 4.052 11.1739 3.512 11.8339 3.08C12.4939 2.648 13.2619 2.432 14.1379 2.432ZM14.1139 11.048C14.7499 11.048 15.2899 10.856 15.7459 10.46C16.2019 10.064 16.5379 9.56 16.7539 8.936C16.9699 8.312 17.0779 7.616 17.0779 6.836C17.0779 6.056 16.9699 5.36 16.7539 4.736C16.5379 4.112 16.2019 3.608 15.7459 3.212C15.2899 2.816 14.7499 2.624 14.1139 2.624C13.4779 2.624 12.9379 2.816 12.4819 3.212C12.0259 3.608 11.6899 4.112 11.4739 4.736C11.2579 5.36 11.1499 6.056 11.1499 6.836C11.1499 7.616 11.2579 8.312 11.4739 8.936C11.6899 9.56 12.0259 10.064 12.4819 10.46C12.9379 10.856 13.4779 11.048 14.1139 11.048ZM26.7543 11.384L26.7423 11.42C25.3383 9.62 23.2623 7.232 20.5023 4.268V7.856C20.5023 8.948 20.6583 9.752 20.9583 10.268C21.2583 10.784 21.7503 11.036 22.4343 11.036H19.3863C19.8303 11.036 20.1063 10.856 20.2023 10.508C20.2983 10.16 20.3463 9.332 20.3463 8.024V7.844V5.396C20.3463 3.548 19.7463 2.624 18.5583 2.624H20.8983C21.0423 2.852 21.2463 3.116 21.5223 3.416C23.7903 6.008 25.4583 7.868 26.5143 8.996V6.8C26.5143 4.976 26.4903 3.872 26.4303 3.5C26.3463 3.02 26.1663 2.732 25.8903 2.648C25.8063 2.624 25.6983 2.612 25.5663 2.612H27.9903C27.7743 2.612 27.5943 2.648 27.4383 2.72C27.2823 2.792 27.1623 2.924 27.0663 3.128C26.9703 3.332 26.8983 3.512 26.8383 3.68C26.7783 3.848 26.7423 4.124 26.7183 4.508C26.6943 4.892 26.6823 5.216 26.6823 5.468C26.6823 5.72 26.6823 6.116 26.6823 6.656V6.788V9.272C26.6823 10.22 26.7063 10.928 26.7543 11.384ZM33.2789 8.576L29.6909 8.6L29.4149 9.296C29.2109 9.824 29.2109 10.244 29.4269 10.556C29.6429 10.868 30.0749 11.024 30.7109 11.024H27.4229C27.8189 11.024 28.1549 10.892 28.4189 10.628C28.6829 10.364 28.9349 9.92 29.1869 9.296L29.5349 8.432V8.42L31.3229 3.98C31.0949 3.512 30.8549 3.164 30.6029 2.936C30.3509 2.708 30.0509 2.6 29.6909 2.6H32.0669C32.8229 4.664 33.6869 6.776 34.6589 8.924C34.7909 9.224 34.9109 9.464 35.0189 9.656C35.1269 9.848 35.2589 10.064 35.4149 10.292C35.5709 10.52 35.7389 10.688 35.9309 10.808C36.1229 10.928 36.3269 10.988 36.5309 10.988H34.0349C33.9509 10.52 33.6989 9.716 33.2789 8.576ZM31.4069 4.196L29.7389 8.432H33.1709C32.8469 7.604 32.6189 7.052 32.4989 6.776C32.3909 6.512 32.2109 6.08 31.9589 5.48C31.7069 4.88 31.5269 4.448 31.4069 4.196ZM39.2029 1.304L39.1909 1.328C39.0109 1.328 38.8669 1.268 38.7589 1.148C38.6509 1.028 38.6029 0.883999 38.6029 0.727999C38.6029 0.572 38.6629 0.427999 38.7709 0.308C38.8789 0.188 39.0229 0.128 39.2029 0.128C39.3589 0.128 39.4909 0.188 39.5989 0.308C39.7069 0.427999 39.7669 0.559999 39.7669 0.715999C39.7669 0.872 39.7069 1.004 39.5989 1.124C39.4909 1.244 39.3589 1.304 39.2029 1.304ZM41.1589 1.328L41.1469 1.352C40.9669 1.352 40.8229 1.292 40.7149 1.172C40.6069 1.052 40.5589 0.908 40.5589 0.752C40.5589 0.595999 40.6189 0.451999 40.7269 0.331999C40.8349 0.211999 40.9789 0.151999 41.1589 0.151999C41.3149 0.151999 41.4469 0.211999 41.5549 0.331999C41.6629 0.451999 41.7229 0.584 41.7229 0.74C41.7229 0.895999 41.6629 1.028 41.5549 1.148C41.4469 1.268 41.3149 1.328 41.1589 1.328ZM36.9829 11.048V11.06C37.3789 11 37.6189 10.724 37.7149 10.244C37.8109 9.764 37.8589 8.636 37.8589 6.86C37.8589 5.084 37.8109 3.956 37.7149 3.476C37.6189 2.996 37.3789 2.72 36.9829 2.66H42.5029L42.8869 5.108C42.6349 3.584 41.6389 2.828 39.8869 2.828H39.0829C38.9629 3.44 38.9029 4.7 38.9029 6.608H40.4749C40.9309 6.608 41.2549 6.44 41.4469 6.104C41.6389 5.768 41.7349 5.264 41.7349 4.604V8.708C41.7349 8.072 41.6269 7.592 41.4109 7.256C41.1949 6.92 40.8829 6.752 40.4749 6.752H38.9029C38.9029 8.9 38.9869 10.256 39.1549 10.832H39.5509C41.8429 10.832 43.0789 9.92 43.2589 8.096L42.9949 11.048H36.9829ZM50.5646 11H44.5766C44.9726 10.94 45.2126 10.664 45.3086 10.184C45.4046 9.704 45.4526 8.576 45.4526 6.8C45.4526 5.024 45.4046 3.896 45.3086 3.416C45.2126 2.936 44.9726 2.66 44.5766 2.6H47.0006C46.7486 2.708 46.6046 2.984 46.5566 3.44C46.5086 3.896 46.4846 5.012 46.4966 6.8C46.4966 8.324 46.5206 9.26 46.5806 9.608C46.6646 10.196 46.8926 10.556 47.2526 10.7C47.4326 10.76 47.6486 10.796 47.9126 10.796C48.4166 10.796 48.8726 10.7 49.2686 10.52C49.6646 10.34 49.9886 10.1 50.2406 9.788C50.4926 9.476 50.6966 9.152 50.8406 8.816C50.9846 8.48 51.1046 8.108 51.1886 7.712L50.5646 11ZM63.4632 2.6L66.8592 2.636C66.3192 2.636 65.9112 2.744 65.6232 2.96C65.3352 3.176 65.1072 3.524 64.9272 3.992C64.5552 4.976 64.0632 6.392 63.4512 8.252C62.8392 10.112 62.4912 11.168 62.4072 11.42C61.7832 9.728 61.0392 7.568 60.1872 4.94C59.5632 6.86 58.7952 9.02 57.8952 11.408C57.6192 10.652 57.3552 9.908 57.1032 9.164C56.8512 8.42 56.5512 7.484 56.1912 6.356C55.8312 5.228 55.5912 4.484 55.4712 4.112C55.3752 3.812 55.3032 3.596 55.2432 3.464C55.1832 3.332 55.0872 3.188 54.9552 3.032C54.8232 2.876 54.6552 2.768 54.4392 2.708C54.2232 2.648 53.9472 2.612 53.6112 2.612H56.4192C56.7792 4.256 57.4632 6.548 58.4592 9.5C59.4192 6.728 59.9592 5.072 60.0792 4.532C59.9832 4.256 59.8992 4.016 59.8392 3.8C59.7072 3.404 59.5032 3.104 59.2272 2.9C58.9512 2.696 58.5552 2.6 58.0392 2.6H60.8472C61.0272 3.668 61.7112 5.96 62.8992 9.488C63.7272 6.908 64.1952 5.408 64.3032 4.988C64.5792 3.92 64.6032 3.224 64.3752 2.912C64.2072 2.708 63.9072 2.6 63.4632 2.6ZM70.7203 8.576L67.1323 8.6L66.8563 9.296C66.6523 9.824 66.6523 10.244 66.8683 10.556C67.0843 10.868 67.5163 11.024 68.1523 11.024H64.8643C65.2603 11.024 65.5963 10.892 65.8603 10.628C66.1243 10.364 66.3763 9.92 66.6283 9.296L66.9763 8.432V8.42L68.7643 3.98C68.5363 3.512 68.2963 3.164 68.0443 2.936C67.7923 2.708 67.4923 2.6 67.1323 2.6H69.5083C70.2643 4.664 71.1283 6.776 72.1003 8.924C72.2323 9.224 72.3523 9.464 72.4603 9.656C72.5683 9.848 72.7003 10.064 72.8563 10.292C73.0123 10.52 73.1803 10.688 73.3723 10.808C73.5643 10.928 73.7683 10.988 73.9723 10.988H71.4763C71.3923 10.52 71.1403 9.716 70.7203 8.576ZM68.8483 4.196L67.1803 8.432H70.6123C70.2883 7.604 70.0603 7.052 69.9403 6.776C69.8323 6.512 69.6523 6.08 69.4003 5.48C69.1483 4.88 68.9683 4.448 68.8483 4.196ZM80.4123 11H74.4243C74.8203 10.94 75.0603 10.664 75.1563 10.184C75.2523 9.704 75.3003 8.576 75.3003 6.8C75.3003 5.024 75.2523 3.896 75.1563 3.416C75.0603 2.936 74.8203 2.66 74.4243 2.6H76.8483C76.5963 2.708 76.4523 2.984 76.4043 3.44C76.3563 3.896 76.3323 5.012 76.3443 6.8C76.3443 8.324 76.3683 9.26 76.4283 9.608C76.5123 10.196 76.7403 10.556 77.1003 10.7C77.2803 10.76 77.4963 10.796 77.7603 10.796C78.2643 10.796 78.7203 10.7 79.1163 10.52C79.5123 10.34 79.8363 10.1 80.0883 9.788C80.3403 9.476 80.5443 9.152 80.6883 8.816C80.8323 8.48 80.9523 8.108 81.0363 7.712L80.4123 11ZM87.817 2.6L87.685 5.54C87.709 4.712 87.469 4.04 86.977 3.536C86.485 3.032 85.681 2.78 84.565 2.78H84.553V6.812C84.553 8.528 84.589 9.596 84.673 10.004C84.769 10.496 84.985 10.796 85.321 10.916C85.501 10.976 85.765 11.012 86.101 11.012H82.417C82.945 11.012 83.269 10.82 83.377 10.448C83.485 10.076 83.533 9.176 83.521 7.76V6.8V2.768H83.509C81.589 2.768 80.545 3.728 80.377 5.66L80.629 2.6H87.817ZM89.2022 11V11.012C89.5982 10.952 89.8382 10.676 89.9342 10.196C90.0302 9.716 90.0782 8.588 90.0782 6.812C90.0782 5.036 90.0302 3.908 89.9342 3.428C89.8382 2.948 89.5982 2.672 89.2022 2.612H94.7222L95.1062 5.06C94.8542 3.536 93.8582 2.78 92.1062 2.78H91.3022C91.1822 3.392 91.1222 4.652 91.1222 6.56H92.6942C93.1502 6.56 93.4742 6.392 93.6662 6.056C93.8582 5.72 93.9542 5.216 93.9542 4.556V8.66C93.9542 8.024 93.8462 7.544 93.6302 7.208C93.4142 6.872 93.1022 6.704 92.6942 6.704H91.1222C91.1222 8.852 91.2062 10.208 91.3742 10.784H91.7702C94.0622 10.784 95.2982 9.872 95.4782 8.048L95.2142 11H89.2022ZM100.084 11L96.7479 11.036C97.1439 10.976 97.3839 10.7 97.4799 10.22C97.5759 9.74 97.6239 8.612 97.6239 6.836C97.6239 5.06 97.5759 3.932 97.4799 3.452C97.3839 2.972 97.1439 2.696 96.7479 2.636H100.048C100.924 2.636 101.632 2.852 102.16 3.296C102.688 3.74 102.952 4.256 102.952 4.844C102.952 5.528 102.664 6.092 102.076 6.548C101.488 7.004 100.804 7.232 100.024 7.232C100.444 7.232 100.864 7.364 101.272 7.628C101.68 7.892 102.016 8.204 102.292 8.564C102.412 8.72 102.568 8.924 102.76 9.176C102.952 9.428 103.084 9.608 103.156 9.704C103.228 9.8 103.336 9.932 103.48 10.1C103.624 10.268 103.732 10.376 103.792 10.424C103.852 10.472 103.948 10.544 104.08 10.64C104.212 10.736 104.32 10.796 104.416 10.82C104.512 10.844 104.632 10.868 104.788 10.904C104.944 10.94 105.1 10.964 105.256 10.976C105.412 10.988 105.604 10.988 105.832 10.988H102.376C101.164 8.48 100.012 7.22 98.9199 7.22C99.7719 7.208 100.456 6.98 100.972 6.548C101.488 6.116 101.74 5.516 101.74 4.748C101.74 4.196 101.56 3.728 101.2 3.344C100.84 2.96 100.348 2.768 99.7119 2.768C99.3879 2.768 99.0999 2.84 98.8479 2.984C98.7639 3.38 98.7159 4.208 98.7159 5.456V6.8C98.7159 8.588 98.7879 9.74 98.9319 10.244C99.0759 10.748 99.4599 11 100.084 11Z" fill="white" />
                    </svg>
                    <h1 className='opacity-0 text-white text-8xl'>Louisiana Diary</h1>
                    <p className='opacity-0 text-white'>Personal photography of my trip to lousiana</p>
                </section>
                <section ref={stickySection} style={{ height: '800vh', width: '100vw' }}>
                    <section ref={stickyTrack} className='grid grid-rows-3 grid-flow-col gap-8 min-h-screen ml sticky top-0 w-fit' style={{ paddingLeft: "50vw", paddingRight: "50vw", transform: `translateX(-${styckyScrolled * trackWidth() / 100}px)` }}>
                        {[...new Array(16)].map((el, index) => {
                            return (
                                <div key={index} data-project-id={index} className={`row-span-2 w-96 aspect-[3/4] m-auto` + ' ' + (index % 2 ? 'row-start-2' : 'row-start-1')} onClick={() => {
                                    setCurrentProject(index + 1);
                                }}>
                                    <ProjectCard id={index} />
                                </div>
                            )
                        })}
                    </section>
                </section>
                {currentProject && (<ProjectSlider closeProject={setCurrentProject} currentIndex={currentProject} />)}
                <Footer />
            </div>
        </>

    );
}